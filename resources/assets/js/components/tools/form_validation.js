// INPUT FORMATTER CLASS

function InputFormatter() {
  this.passFormat = function(elem){
    if ($("#" + elem).val() == "") {
      $("#"  + elem).removeClass('pass-bullets');
    } else {
      $("#" + elem).addClass('pass-bullets');
    }
  }
}

let formatter = new InputFormatter();

// Styles payment amount into $0.00 format
function amtFloat(){
  if (!isNaN(paymentAmt.value) && paymentAmt.value != "") {
     paymentAmt.value = "$" + parseFloat(paymentAmt.value).toFixed(2);
  } else {
     paymentAmt.value = "";
     paymentAmt.className = "";
     paymentAmt.placeholder = "$0.00";
  }
};
// Styles card into xxxx-xxxx-xxxx-xxxx format
function formatCard(x){
    var ccArr = creditNum.value.split('-'),
    	start = x.selectionStart;

    	ccArr = ccArr.join('');
    	ccArr = ccArr.split('');

    for (i = 0; i <= ccArr.length-1; i++){
    	if (i == 4 || i == 9 || i == 14){
        	if (ccArr[i] != "-"){
            	ccArr.splice(i, 0, "-");
            } else {
            	continue;
            };
        };
    };
    creditNum.value = ccArr.slice(0,19).join('');
    if (start < creditNum.value.length-1){
    	x.setSelectionRange(start, start);
    };
};

// Verifies if input is a number & allows only numerical input
function isNumber(evt, id) {
    evt = (evt) ? evt : window.event;
    var charCode = (evt.which) ? evt.which : evt.keyCode;
    if (charCode > 31 && (charCode < 45 || charCode > 57)) {
        return false;
    };
    if (id == "payment-amount"){
    	if (charCode == 47 || charCode == 45){
    		return false;
    	};
    } else if (id == "credit-cvcode" || id=="credit-num"){
    	if (charCode == 47 || charCode == 46 || charCode == 45){
    		return false;
    	};
    };
    return true;
};

// Check credit card validity via Luhn algorithm check
function checkCard(userInput){
	var backwards = "";
	var multiplyx2 = "";
	var total = 0;
	for(i = userInput.length-2; i >= 0; i-=2){
		backwards += userInput.charAt(i);
	}
	for(i = 0; i < backwards.length; i++){
		multiplyx2 += backwards.charAt(i)*2;
	}
	for(i = 0; i < multiplyx2.length; i++){
		total += parseInt(multiplyx2.charAt(i));
	}
	for(i = userInput.length-3; i >= 0; i-=2){
		total += parseInt(userInput.charAt(i));
	}
	total += parseInt(userInput.charAt(userInput.length-1))
	if((total % 10) == 0 && creditNum.value.length > 10){
		return true;
	}
};

// Get's cc payment method, eg. visa, mc, amex, discover
function getMethod(input){
    var number = input.toString();
    var re = new RegExp("^4");
    if (number.match(re) != null){ return "visa"; }

    re = new RegExp("^5[1-5]");
    if (number.match(re) != null){ return "mastercard"; }

    re = new RegExp("^3[47]");
    if (number.match(re) != null){ return "amex"; }

    re = new RegExp("^(6011|622(12[6-9]|1[3-9][0-9]|[2-8][0-9]{2}|9[0-1][0-9]|92[0-5]|64[4-9])|65)");
    if (number.match(re) != null){ return "discover"; }

    return "";
};

// INPUT VALIDATION BUILDER
function InputValidator() {
  this.isValid = function(obj) {
    let v = [];
    for (let i = 0; i < obj.length; i++) {
      let bool = true;
      switch (obj[i].type) {
        case "email" :
          bool = validEmail(obj[i].elem);
          break;
        case "pass" :
          bool = validPass(obj[i].elem);
          break;
        case "strongpass" :
          bool = strongPass(obj[i].elem);
          break;
        case "string" :
          bool = validString(obj[i].elem);
          break;
        case "phone" :
          bool = validPhone(obj[i].elem);
          break;
        case "zip" :
          bool = validZip(obj[i].elem);
          break;
        default:
          bool = false;
          break;
      }
      if (bool == false) {
        this.showError([obj[i].elem]);
        v.push(obj[i].elem);
      } else {
        this.hideError([obj[i].elem]);
      }
    }
    if (v.length > 0){ return v } else { return true };
  }
  this.showError = function(elem) {
    for (let i = 0; i < elem.length; i++){
      $("#" + elem[i]).addClass('ds-form-error');
      if ($("#" + elem[i] + -"err"))
          $("#" + elem[i] + "-err").addClass('ds-show-errmsg');
    }
  }
  this.hideError = function(elem) {
    for (let i = 0; i < elem.length; i++){
      $("#" + elem[i]).removeClass('ds-form-error');
      $("#" + elem[i] + "-err").removeClass('ds-show-errmsg');
    }
  }
  this.clearInputs = function(arr) {
    for (let i = 0; i < arr.length; i++) {
      $('#' + arr[i]).val('');
    }
  }
}

let validator = new InputValidator;

function validEmail(input){
  userEmail = $('#' + input).val();
  var isEmail = 0;
  for (i = 0; i <=userEmail.length; i++){
      if (userEmail.slice(0,1) != "@"){
          if (userEmail.slice(i, i+1) == "@") {
              isEmail += 1;
          } else if (userEmail.slice(i, i+1) == "."){
          	if (userEmail.slice(i-1, i) != "@"){
      	       isEmail *= 2;
            };
          };
      };
      if (userEmail.slice(i , i+1) == " "){
        return false;
      }
  };
  if (isEmail >= 2) {
    return true;
  } else {
   return false;
 }
}

function validPass(input) {
  let str = $("#" + input).val();
  let spaces = false;
  for (let i = 0; i < str.length; i++) {
    if (str.slice(i, i+1) != ' ') spaces = true;
  }
  if (str != '' && spaces){
    return true
  } else {
    return false;
  }
}

function strongPass(input) {
  let str = $("#" + input).val();
  let strong = new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.{8,})");
  if (!strong.test(str)) {
    return false;
  } else {
    return true;
  }
}

function validString(input, type) {
    let str = $("#" + input).val();

    if (str == undefined || str == "") {
      return false;
    } else {
      return true;
    }
}

function validZip(input) {
  let str = $("#" + input).val();
  let regX = /(^\d{5}$)|(^\d{5}-\d{4}$)/;

  if (!regX.test(str)) {
    return false;
  } else {
    return true;
  }
}

function validPhone(input) {
  let num = $("#"+ input).val();
  if(num.length < 13) {
    return false;
  } else {
    return true;
  }
}
